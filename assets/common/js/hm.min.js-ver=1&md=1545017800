(function () {
    var second = 0,ck = 0;
    var ref = window.top.document.referrer;
    var weber = "[{}]";
    weber = eval("("+weber+")");
    var host = encodeURIComponent(window.location.href);

    var tag = getCookie("QZSRC") == null?"":getCookie("QZSRC");
    var uuid = getCookie("QZUUID") == null?"":getCookie("QZUUID");

    weber = {
        uuid:uuid,
        tag:tag,
        host:host,
        ref: encodeURIComponent(ref.substring(0,100)),
        timeIn: Date.parse(new Date())/1000,
        enabled:navigator.cookieEnabled?1:0
    }

    var li = document.getElementsByTagName('a');

    for (var i = 0; i < li.length; i++) {
        if (!isNotIE()) {
            li[i].attachEvent("onclick",function(){
                ck ++;
            });
        } else {
            li[i].addEventListener("click",function(){
                ck ++;
            });
        }
    }

    function http_send() {
        // try {
        //     var str = [];
        //     for(var i in weber) {
        //         str.push(i +"="+ encodeURIComponent(weber[i]));
        //     }
        //     str = str.join("&");
        //     var url =  "/hm?" + str;
        //     var img = document.createElement("img");
        //     img.setAttribute("src",url);
        //     document.querySelector("body").appendChild(img);
        // } catch (e) {
        // }
    }

    function GetQueryString(url,name) {
        url = url.split("?")[1];
        try {
            var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
            var r = url.match(reg);

            if (r != null){
                return unescape(r[2]);
            }
        } catch (err){
            return null;
        }
        return null;
    }

    function uuid() {
        var s = [];
        var hexDigits = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";
        for (var i = 0; i < 36; i++) {
            s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
        }
        s[14] = "4";
        s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
        s[8] = s[13] = s[18] = s[23] = "";

        var uuid = s.join("");
        return uuid;
    }

    function setCookie(name,value){
        var path ="";
        var date = new Date();
        date.setTime(date.getTime() + 30 * 60 * 1000);
        var expires = "; expires=" + date.toGMTString();
        document.cookie = name + "=" + encodeURIComponent(value) + expires + ";domain=.qizuang.com;path=/";
    }

    function getCookie(name) {
        var arr,reg = new RegExp("(^| )"+name+"=([^;]*)(;|$)");
        if(arr = reg.exec(document.cookie)){
            return unescape(arr[2]);
        }
        return null;
    }

    function isIE() {
        if (!!window.ActiveXObject || "ActiveXObject" in window){
            return true;
        }
        return false;
    }

    function isNotIE(){
        if (window.navigator.userAgent.indexOf("MSIE")>=1){
            return false;
        }
        return true;
    }

    function isFirefox() {
        if(isFirefox=navigator.userAgent.indexOf("Firefox")>0){
            return true;
        }
        return false;
    }

    window.setInterval(function(){
        second ++;
    },1000);

    http_send();
})();
